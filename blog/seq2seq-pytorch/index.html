<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="IE=edge" http-equiv=X-UA-Compatible><title>Triển khai seq2seq với Pytorch • TDung&#39;s Site</title><link href=/favicon/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon/favicon-32x32.png rel=icon type=image/png sizes=32x32><link href=/favicon/favicon-16x16.png rel=icon type=image/png sizes=16x16><link href=/favicon/site.webmanifest rel=manifest><link href=/fonts/Satoshi-Variable.ttf rel=preload type=font/ttf as=font crossorigin><link href=/fonts/Satoshi-VariableItalic.ttf rel=preload type=font/ttf as=font crossorigin><link href=https://zhaospei.github.io/blog/seq2seq-pytorch rel=canonical><meta content="Triển khai seq2seq với Pytorch • TDung's Site" name=title><meta content="Bài viết này giới thiệu cách sử dụng Pytorch để xây dựng mô hình seq2seq và triển khai một ứng dụng dịch máy đơn giản" name=description><meta content="Tuan-Dung Bui" name=author><meta content="" name=theme-color><meta content=article property=og:type><meta content="Triển khai seq2seq với Pytorch" property=og:title><meta content="Bài viết này giới thiệu cách sử dụng Pytorch để xây dựng mô hình seq2seq và triển khai một ứng dụng dịch máy đơn giản" property=og:description><meta content=https://zhaospei.github.io/blog/seq2seq-pytorch property=og:url><meta content="TDung's Site" property=og:site_name><meta content=en_US property=og:locale><meta content=https://zhaospei.github.io/_astro/pytorch.BgBWJuWz.png property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content="Tuan-Dung Bui" property=article:author><meta content=2023-10-20T08:00:00.000Z property=article:published_time><meta content=summary_large_image property=twitter:card><meta content=https://zhaospei.github.io/blog/seq2seq-pytorch property=twitter:url><meta content="Triển khai seq2seq với Pytorch" property=twitter:title><meta content="Bài viết này giới thiệu cách sử dụng Pytorch để xây dựng mô hình seq2seq và triển khai một ứng dụng dịch máy đơn giản" property=twitter:description><meta content=https://zhaospei.github.io/_astro/pytorch.BgBWJuWz.png property=twitter:image><meta content=@cworld0_cn name=telegram:channel><link href=/sitemap-index.xml rel=sitemap><link href=https://zhaospei.github.io/rss.xml rel=alternate type=application/rss+xml title="TDung's Site"><meta content="Astro v4.12.2" name=generator><meta content=https://waline-a0tqnine3-dung-bui-tuans-projects.vercel.app/ name=waline-server-url><link href=/styles/global.css rel=stylesheet><vercel-speed-insights data-params={&#34;slug&#34;:&#34;seq2seq-pytorch&#34;} data-pathname=/blog/seq2seq-pytorch data-props={}></vercel-speed-insights><script>console.log("%c Astro-theme-pure %c https://github.com/cworld1/theme-astro-pure/","color:#fff;background:linear-gradient(90deg,#448bff,#44e9ff);padding:5px 0;","color:#000;background:linear-gradient(90deg,#44e9ff,#ffffff);padding:5px 10px 5px 0px;")</script><link href=/_astro/_slug_.S7CTld6O.css rel=stylesheet><link href=/_astro/_slug_.CmQlfj-r.css rel=stylesheet><style>#waline[data-astro-cid-ksttp56e]{--waline-font-size:16px;--waline-white:hsl(var(--background) / var(--tw-bg-opacity));--waline-light-grey:#999;--waline-dark-grey:#666;--waline-theme-color:hsl(var(--foreground) / var(--tw-text-opacity));--waline-active-color:hsl(var(--primary) / var(--tw-text-opacity));--waline-color:hsl(var(--muted-foreground) / var(--tw-text-opacity));--waline-bg-color:hsl(var(--primary-foreground) / var(--tw-bg-opacity));--waline-bg-color-light:hsl(var(--input) / var(--tw-bg-opacity));--waline-bg-color-hover:#f0f0f0;--waline-border-color:hsl(var(--border) / var(--tw-border-opacity));--waline-disable-bg-color:#f8f8f8;--waline-disable-color:#bbb;--waline-code-bg-color:#282c34;--waline-bq-color:#f0f0f0;--waline-avatar-size:3.25rem;--waline-m-avatar-size:calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color:#3498db;--waline-badge-font-size:.775em;--waline-info-bg-color:var(--waline-bg-color-light);--waline-info-color:var(--waline-color);--waline-info-font-size:.625em;--waline-border:1px solid var(--waline-border-color);--waline-avatar-radius:50%;--waline-box-shadow:none}#waline[data-astro-cid-ksttp56e] .wl-reaction-title{display:none!important}#waline[data-astro-cid-ksttp56e] .wl-reaction{overflow:visible}@media (max-width:640px){#waline[data-astro-cid-ksttp56e] .wl-card-item{padding:0!important}#waline[data-astro-cid-ksttp56e] .wl-cards .wl-user{margin-inline-end:.45em}}</style><link href=/_astro/_slug_.CSrZ5wIX.css rel=stylesheet><script type=module src=/_astro/hoisted.bUwIQdaM.js></script><script type=module src=/_astro/page.DFwqf4PB.js></script></head><body class="flex bg-background justify-center"><div class="w-full absolute start-0 z-0 h-1/2 opacity-25 pointer-events-none top-0" style=background-image:linear-gradient(#64574d,transparent)></div><script>const lightModePref=window.matchMedia("(prefers-color-scheme: light)");function getUserPref(){return localStorage.getItem("theme")||(lightModePref.matches?"light":"dark")}function setTheme(e,t=!1){if(!["light","dark"].includes(e))return void console.log(`Invalid theme value '${e}' received. Expected 'light' or 'dark'.`);t&&localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark","dark"===e);const r="dark"===e?"#0B0B10":"#FCFCFD";document.querySelector('meta[name="theme-color"]')?.setAttribute("content",r)}setTheme(getUserPref()),document.addEventListener("astro:after-swap",(()=>setTheme(getUserPref()))),document.addEventListener("theme-change",(e=>{const t=e.detail.theme;localStorage.setItem("theme",t),setTheme(e.detail.theme,!0)})),lightModePref.addEventListener("change",(e=>{setTheme(e.matches?"light":"dark")}))</script><main class="flex items-center flex-col leading-relaxed lg:px-10 max-w-[60rem] min-h-screen pb-10 px-4 sm:px-7 text-[0.92rem] w-screen z-10"><header-component class="transition-all duration-300 border-transparent group [&#38;.not-top]:bg-background [&#38;.not-top]:border-border border box-content dark:[&#38;.not-top]:bg-primary-foreground mb-16 py-1 rounded-xl sm:rounded-2xl sticky top-4 w-full z-30" data-astro-cid-qlfjksao><header class="flex flex-wrap sm:flex-nowrap sm:justify-start text-sm" data-astro-cid-qlfjksao><nav aria-label=global class="flex items-center justify-between mx-auto relative sm:flex sm:items-center w-full" data-astro-cid-qlfjksao><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] !duration-0 -top-8 h-20 max-sm:group-[.expanded]:bg-white" data-astro-cid-qlfjksao></div><a href=/ class="transition-all duration-300 flex-none font-semibold group-[.not-top]:ms-3 sm:group-[.not-top]:ms-5 text-xl" aria-label=Brand data-astro-cid-qlfjksao>TDung&#39;s Site</a><div class="flex gap-x-4 sm:gap-x-6" data-astro-cid-qlfjksao><div class="transition-all duration-300 dark:group-[.expanded.not-top]:bg-primary-foreground end-0 grid group-[.expanded]:opacity-100 group-[.not-top]:rounded-xl max-md:border-b max-sm:absolute max-sm:group-[.expanded]:bg-background max-sm:group-[.not-top]:border max-sm:group-[.not-top]:pb-2 max-sm:group-[.not-top]:pt-2 max-sm:group-[.not-top]:px-4 max-sm:opacity-0 max-sm:pb-4 max-sm:pt-0 sm:border-0 sm:grid-rows-1 start-0 top-12 z-20" data-astro-cid-qlfjksao id=headerExpandConetent><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] bg-white h-full max-md:border-b top-0" data-astro-cid-qlfjksao></div><div class="flex items-center flex-col sm:flex-row gap-x-5 gap-y-2 justify-center overflow-hidden sm:gap-x-7 transition-colors" data-astro-cid-qlfjksao><a href=/blog class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Blog </a><a href=/projects class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Projects </a><a href=/links class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Links </a><a href=/about class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>About</a><div class="flex flex-row gap-x-3 grow justify-end sm:gap-x-5 sm:w-fit w-full" data-astro-cid-qlfjksao><a href=https://www.travellings.cn/go.html class="px-1 py-2" data-astro-cid-qlfjksao title=Travelling><span class=sr-only data-astro-cid-qlfjksao>Travelling</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-train-2-line data-astro-cid-qlfjksao></use></svg> </a><a href=/search class="px-1 py-2" data-astro-cid-qlfjksao title=Search><span class=sr-only data-astro-cid-qlfjksao>Search</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-search-2-line data-astro-cid-qlfjksao></use></svg></a></div></div></div><div class="flex gap-x-4 group-[.not-top]:gap-x-2 group-[.not-top]:me-1.5 transition-all" data-astro-cid-qlfjksao><button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl group/dark" id=toggleDarkMode data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Dark Theme</span> <svg class="transition-all group-hover/dark:text-primary size-5 dark:hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-sun-line data-astro-cid-qlfjksao></use></svg> <svg class="transition-all group-hover/dark:text-primary size-5 dark:block hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-moon-stars-line data-astro-cid-qlfjksao></use></svg></button> <button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl sm:hidden" id=toggleMenu data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Menu</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-menu-line data-astro-cid-qlfjksao></use></svg></button></div></div></nav></header></header-component><div class=w-full style=--primaryColor:#64574D data-astro-cid-bvzihdzo><a href=/blog class="transition-all border bg-primary-foreground border-border gap-x-1 group hover:bg-input inline-flex items-center no-underline px-2 py-1 rounded-lg text-muted-foreground text-sm" data-astro-cid-bvzihdzo data-astro-prefetch><svg class="group-hover:stroke-primary stroke-muted-foreground" fill=none height=16 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=16 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:scale-x-100 scale-x-0 group-hover:translate-x-0 translate-x-3" x1=19 x2=5 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-0 translate-x-1" points="12 19 5 12 12 5"></polyline></svg><p class=my-0>Back</p></a><div class="gap-x-10 lg:flex lg:items-start mt-8" style=--primaryColor:#64574D data-astro-cid-bvzihdzo><aside class="animate -me-24 basis-60 max-lg:hidden order-2 sticky top-[15%]"><toc-heading><h2 class=font-semibold>TABLE OF CONTENTS</h2><ul class="max-h-[70vh] mt-4 overflow-y-scroll text-card-foreground"><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#hãy-bắt-đầu-giải-thích-mã class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Hãy bắt đầu giải thích mã">Hãy bắt đầu giải thích mã</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#mã-hoàn-chỉnh-như-sau class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Mã hoàn chỉnh như sau">Mã hoàn chỉnh như sau</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#tham-khảo class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Tham khảo">Tham khảo</a></div></li></ul></toc-heading></aside><article class="break-words flex-grow" data-astro-cid-bvzihdzo data-pagefind-body style=flex-grow:3;flex-shrink:1;flex-basis:60%;--primaryColor:#64574D><div style=--primaryColor:#64574D data-astro-cid-bvzihdzo id=blog-hero><div class="relative animate hero-image max-lg:mx-auto mb-6 prose"><img alt="Triển khai seq2seq với Pytorch" decoding=async height=900 loading=eager src=/_astro/pytorch.BgBWJuWz_ZNN7Bm.webp width=1600 class="w-full relative cover-image h-auto object-contain rounded-2xl z-10" fetchpriority=high inferSize=true><img alt="Triển khai seq2seq với Pytorch" decoding=async height=900 loading=eager src=/_astro/pytorch.BgBWJuWz_ZNN7Bm.webp width=1600 class="duration-300 absolute blur-xl h-full mt-0 opacity-40 start-0 top-4 transition-opacity w-full z-0" fetchpriority=high inferSize=true id=blurImage></div><div class="animate max-lg:mx-auto article-info max-w-[65ch]"><div class="flex flex-wrap gap-x-4 gap-y-2 leading-6 text-muted-foreground text-xs"><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-calendar-2-line></use></svg> <samp class=text-muted-foreground><time datetime=2023-10-20T08:00:00.000Z>Oct 20, 2023</time></samp></div><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-time-line></use></svg> 12 min read</div><span class="flex items-center gap-1"><svg class=size-5><use href=/icons/project.svg#mingcute-earth-2-line></use></svg> Vietnamese</span></div><h1 class="font-medium mt-4 sm:mb-2 sm:mt-6 sm:text-3xl text-2xl">Triển khai seq2seq với Pytorch</h1><div class="flex items-center flex-row flex-wrap gap-x-1 mt-3 sm:mt-5"><svg class=size-5><use href=/icons/ui.svg#mingcute-tag-line></use></svg><div><a href=/tags/nlp/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag nlp" data-pagefind-filter=tag>nlp </a>,</div><div><a href=/tags/pytorch/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag pytorch" data-pagefind-filter=tag>pytorch </a>,</div><div><a href=/tags/model/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag model" data-pagefind-filter=tag>model</a></div></div><div class="mt-3 italic"><blockquote class="text-muted-foreground text-sm"><q>Bài viết này giới thiệu cách sử dụng Pytorch để xây dựng mô hình seq2seq và triển khai một ứng dụng dịch máy đơn giản</q></blockquote><div class="text-muted-foreground text-sm mt-1"><span class=waline-pageview-count data-path=/blog/seq2seq-pytorch></span> views | <span class=waline-comment-count data-path=/blog/seq2seq-pytorch></span> comments</div></div></div><div class="sm:mt-6 mt-4 border-t max-lg:mx-auto sm:w-1/3 w-1/2"></div></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc animate max-lg:mx-auto" style=--primaryColor:#64574D data-astro-cid-bvzihdzo id=content><p>Bài viết này giới thiệu cách sử dụng <code>Pytorch</code> để xây dựng mô hình seq2seq và triển khai một ứng dụng dịch máy đơn giản, vui lòng đọc sơ qua bài báo sau trước, <a href=https://arxiv.org/pdf/1406.1078.pdf target=_blank rel="nofollow, noopener, noreferrer">Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation(2014)</a>, để hiểu rõ cấu trúc seq2seq hoạt động như thế nào, sau đó đọc bài viết này để đạt được hiệu quả gấp đôi chỉ với một nửa công sức.</p><p>Tôi đã thấy rất nhiều sơ đồ cấu trúc mạng seq2seq và tôi cảm thấy sơ đồ này do Pytorch cung cấp là dễ hiểu nhất.</p><img alt="" decoding=async height=230 loading=lazy src=/_astro/seq2seq.nelT3ab3_Z1IjysD.webp width=510><p>Trước hết, từ hình trên ta có thể thấy rõ ràng, seq2seq cần hoạt động trên ba “biến”, khác với tất cả các cấu trúc mạng mà tôi đã tiếp xúc trước đây. Chúng ta gọi đầu vào cho Encoder là <code>enc_input</code>, đầu vào cho Decoder là <code>dec_input</code> và đầu ra của Decoder là <code>dec_output</code>. Phần sau đây sử dụng một ví dụ cụ thể để minh họa cho toàn bộ quy trình thực hiện của seq2seq.</p><p>Hình bên dưới là cấu trúc Encoder cấu tạo từ LTSM, đầu vào là từng chữ cái (bao gồm cả dấu cách) trong “go away”, chúng ta cần thông tin của <code>hidden state</code> ở thời điểm cuối cùng, bao gồm <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding=application/x-tex>h_{t}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8444em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.2806em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding=application/x-tex>c_{t}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.5806em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.2806em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span>.</p><img alt="" decoding=async height=437 loading=lazy src=/_astro/LSTM_Encoder.D6UmMi3N_Z1wEwQ0.webp width=812><p>Sau đó sử dụng đầu ra gồm <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mi>t</mi></msub></mrow><annotation encoding=application/x-tex>h_{t}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8444em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.2806em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>c</mi><mi>t</mi></msub></mrow><annotation encoding=application/x-tex>c_{t}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.5806em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.2806em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> làm đầu vào cho hidden state đầu tiên của Decoder là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mn>0</mn></msub><mo separator=true>,</mo><msub><mi>c</mi><mn>0</mn></msub></mrow><annotation encoding=application/x-tex>h_{0}, c_{0}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8889em;vertical-align:-.1944em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span><span class=mpunct>,</span><span style=margin-right:.1667em class=mspace></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span>, như hình bên dưới. Đồng thời, lớp đầu vào (<code>input layer</code>) đầu của Decoder sẽ được nhập một ký tự đại diện cho phần đầu của câu (Do người dùng tự định nghĩa có thể là “&#x3C;SOS>”, “\t”, “S”, … đều được chấp nhận. Ở đây, tôi lấy “\t” làm ví dụ), và sau đó nhận đầu ra “m”, và một hidden state mới <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>h_{1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8444em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>c_{1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.5806em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span></p><img alt="" decoding=async height=574 loading=lazy src=/_astro/gFRVkq.BUXnM1zJ_1k7xSo.webp width=1057><p>Sau đó lấy <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>h_{1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8444em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span>, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>c_{1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.5806em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> và “m” làm đầu vào, nhận đầu ra là “a”, và một hidden state mới <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>h</mi><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>h_{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.8444em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>c_{2}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span style=height:.5806em;vertical-align:-.15em class=strut></span><span class=mord><span class="mord mathnormal">c</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span style=height:.3011em class=vlist><span style=top:-2.55em;margin-left:0;margin-right:.05em><span style=height:2.7em class=pstrut></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span style=height:.15em class=vlist><span></span></span></span></span></span></span></span></span></span></p><img alt="" decoding=async height=574 loading=lazy src=/_astro/gFR1B9.CNoz-lw-_cpAca.webp width=904><p>Lặp lại các bước trên cho đến khi ký tự kết thúc của câu cuối cùng được xuất ra (do người dùng xác định, “&#x3C;EOS>”, “\n”, “E”, … ở đây tôi lấy “\n” làm ví dụ).</p><img alt="" decoding=async height=626 loading=lazy src=/_astro/gFRGA1.CFQ-UonV_ZblunT.webp width=1082><p>Trong phần Decoder, bạn sẽ có thể có những câu hỏi sau và tôi sẽ trả lời chúng theo hiểu biết cá nhân.</p><ul><li>Tôi phài làm như thế nào nếu Decoder không thể dừng lại trong quá trình đào tạo? Tức là ký tự kết thúc của câu không bao giờ được đưa ra.<ul><li>Đầu tiên, trong quá trình huấn luyện, <strong>độ dài của câu mà Decoder sẽ xuất ra sẽ được biết</strong>. Giả sử thời điểm hiện tại đã đến ký tự cuối cùng của độ dài câu và dự đoán không phải là ký tự kết thúc thì cũng không sao, chỉ dừng lại ở đây và tính toán tổn thất.</li></ul></li><li>Tôi phải làm như thế nào nếu Decocder không thể dừng lại trong quá trình kiểm tra? Ví dụ, dự đoán là “wasd s w \n sdsw \n … (tiếp tục sinh từ)”<ul><li>Nó sẽ không dừng lại, vì trong quá trình kiểm tra, Decoder cũng có đầu vào, nhưng đầu vào này có rất nhiều placeholder vô nghĩa, chẳng hạn rất nhiều “&#x3C;pad>“. Vì Decoder phải có đầu ra có độ dài hữu hạn. Khi đó bạn chỉ lấy tất cả các ký tự trước ký tự kết thúc đầu tiên. Ví dụ trên kết quả dự đoán cuối cùng là “wasd s w”.</li></ul></li><li>Mối quan hệ giữa đầu vào và đầu ra của Decoder, tức là <code>dec_input</code> và <code>dec_output</code> là gì?<ul><li>Trong quá trình huấn luyện, bất kể Decoder sinh ra kí tự nào tại thời điểm hiện tại, Decoder tại thời điểm tiếp theo sẽ nhập theo “kế hoạch” ban đầu. Ví dụ: giả sử <code>dec_input = "\twasted"</code>, sau khi nhập “\t” lần đầu, Decoder sẽ xuất ra chữ “m”, ghi lại thôi, nó sẽ không ảnh hưởng đến thời điểm tiếp theo khi Decoder tiếp tục nhập chữ “w”.</li><li>Trong quá trình valid và testing, đầu ra của Decoder tại mỗi thời điểm sẽ ảnh hưởng đến đầu vào, vì trong quá trình valid và testing, mạng không thể nhìn thấy kết quả nên chỉ tiến hành theo vòng lặp. Ví dụ, bây giờ tôi muốn dịch từ “wasted” trong tiếng anh sang tiếng “lãng phí” trong tiếng việt. Sau đó, Decoder bắt đầu với việc nhập ký tự “\t”, nhận kết quả đầu ra nếu là “m”, tại thời điểm tiếp theo, Decoder sẽ nhập “m”, nhận đầu ra, nếu là “a”, sau đó nhận “a” là đầu vào, nhận đầu ra, … và cứ thế cho đến khi gặp kí tự cuối cùng hoặc đạt độ dài tối đa. Mặc dù từ sinh ra không đúng nhưng mong đợi nhưng phải chấp nhận thôi :smiley:.</li></ul></li></ul><p>Hơi lạc đề một chút, cá nhân tôi nghĩ seq2seq rất giống với AutoEncoder.</p><h2 id=hãy-bắt-đầu-giải-thích-mã>Hãy bắt đầu giải thích mã</h2><p>Đầu tiên, import thư viện, ở đây tôi dùng ‘S’ làm ký tự bắt đầu và ‘E’ làm ký tự kết thúc, nếu đầu vào hoặc đầu ra quá ngắn, tôi sẽ padding nó bằng ký tự ’?‘.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># code by Tae Hwan Jung(Jeff Jung) @graykode, modify by zhaospei</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.nn </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.utils.data </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Data</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>device </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.device(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'cuda'</span><span style=color:#d73a49;--shiki-dark:#F97583> if</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.cuda.is_available() </span><span style=color:#d73a49;--shiki-dark:#F97583>else</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'cpu'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># S: Symbol that shows starting of decoding input</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># E: Symbol that shows starting of decoding output</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># ?: Symbol that will fill in blank sequence if current batch data size is short than n_step</span></span>
<span class=line></span></code></pre><p>Xác định tập dữ liệu và các tham số tập dữ liệu ở đây rất đơn giản, có thể coi như một công việc dịch thuật, chỉ là dịch tiếng Anh sang tiếng Anh. `n_step“ là độ dài của từ dài nhất, tất cả các từ khác không đủ dài sẽ được padding bằng ’?‘.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>letter </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [c </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> c </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'SE?abcdefghijklmnopqrstuvwxyz'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>letter2idx </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {n: i </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i, n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> enumerate</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(letter)}</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>seq_data </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'women'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'white'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'queen'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'girl'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'boy'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'down'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'high'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'low'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Seq2Seq Parameter</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_step </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> max</span><span style=color:#24292e;--shiki-dark:#E1E4E8>([</span><span style=color:#005cc5;--shiki-dark:#79B8FF>max</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(i), </span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(j)) </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i, j </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq_data]) </span><span style=color:#6a737d;--shiki-dark:#6A737D># max_len(=5)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 128</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(letter2idx) </span><span style=color:#6a737d;--shiki-dark:#6A737D># classfication problem</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>batch_size </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 3</span></span>
<span class=line></span></code></pre><p>Sau đây là xử lý dữ liệu, trước tên là xử lý các từ không đủ độ dài, sử dụng ký tự ’?’ để padding; Sau đó thêm flag kết thúc ‘E’ vào cuối dữ liệu đầu vào của Encoder, thêm flag bắt đầu ‘S’ vào đầu dữ liệu đầu vào của Decoder và flag kết thúc ‘E’ vào cuối dữ liệu đầu ra của Decoder. Xem hình phía dưới để hiểu rõ hơn.</p><p>{% include image.html url=“/assets/media/post/gFRU1O.png” %}</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> make_data</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(seq_data):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input_all, dec_input_all, dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [], [], []</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq_data:</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>            seq[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> '?'</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (n_step </span><span style=color:#d73a49;--shiki-dark:#F97583>-</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(seq[i])) </span><span style=color:#6a737d;--shiki-dark:#6A737D># 'man??', 'women'</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['m', 'a', 'n', '?', '?', 'E']</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'S'</span><span style=color:#d73a49;--shiki-dark:#F97583> +</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['S', 'w', 'o', 'm', 'e', 'n']</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_output </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['w', 'o', 'm', 'e', 'n', 'E']</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input_all.append(np.eye(n_class)[enc_input])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input_all.append(np.eye(n_class)[dec_input])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_output_all.append(dec_output) </span><span style=color:#6a737d;--shiki-dark:#6A737D># not one-hot</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # make tensor</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.Tensor(enc_input_all), torch.Tensor(dec_input_all), torch.LongTensor(dec_output_all)</span></span>
<span class=line></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>'''</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>enc_input_all: [6, n_step+1 (because of 'E'), n_class]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>dec_input_all: [6, n_step+1 (because of 'S'), n_class]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>dec_output_all: [6, n_step+1 (because of 'E')]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>'''</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>enc_input_all, dec_input_all, dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> make_data(seq_data)</span></span>
<span class=line></span></code></pre><p>Ví có ba dữ liệu trả về ở đây, vì vậy cần tùy chỉnh Dataset, cụ thể là kế thừa lớp <code>torch.utils.data.Dataset</code>, sau đó triển khai các phương thức <code>__len__</code> và <code>__getitem__</code> bên trong.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>class</span><span style=color:#6f42c1;--shiki-dark:#B392F0> TranslateDataSet</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Data</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Dataset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, enc_input_all, dec_input_all, dec_output_all):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input_all</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_input_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_input_all</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_output_all</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    </span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __len__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self): </span><span style=color:#6a737d;--shiki-dark:#6A737D># return dataset size</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    </span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __getitem__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, idx):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all[idx], </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_input_all[idx], </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_output_all[idx]</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>loader </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Data.DataLoader(TranslateDataSet(enc_input_all, dec_input_all, dec_output_all), batch_size, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span></code></pre><p>Xác định mô hình seq2seq bên dưới, tôi sử dụng RNN đơn giản làm Encoder và Decoder. Nếu bạn đã quen thuộc với RNN thì thực sự không có gì phải nói về việc xác định cấu trúc mạng, tôi cũng đã viết nhận xét rất rõ ràng, bao gồm cả những thay đổi về kích thước dữ liệu.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Model</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>class</span><span style=color:#6f42c1;--shiki-dark:#B392F0> Seq2Seq</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>nn</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Module</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        super</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(Seq2Seq, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>).</span><span style=color:#005cc5;--shiki-dark:#79B8FF>__init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>()</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.encoder </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.RNN(</span><span style=color:#e36209;--shiki-dark:#FFAB70>input_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class, </span><span style=color:#e36209;--shiki-dark:#FFAB70>hidden_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden, </span><span style=color:#e36209;--shiki-dark:#FFAB70>dropout</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># encoder</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.decoder </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.RNN(</span><span style=color:#e36209;--shiki-dark:#FFAB70>input_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class, </span><span style=color:#e36209;--shiki-dark:#FFAB70>hidden_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden, </span><span style=color:#e36209;--shiki-dark:#FFAB70>dropout</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># decoder</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.fc </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.Linear(n_hidden, n_class)</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> forward</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, enc_input, enc_hidden, dec_input):</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # enc_input(=input_batch): [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # dec_inpu(=output_batch): [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># enc_input: [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_input.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># dec_input: [n_step+1, batch_size, n_class]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # h_t : [num_layers(=1) * num_directions(=1), batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        _, h_t </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.encoder(enc_input, enc_hidden)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # outputs : [n_step+1, batch_size, num_directions(=1) * n_hidden(=128)]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        outputs, _ </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.decoder(dec_input, h_t)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        model </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.fc(outputs) </span><span style=color:#6a737d;--shiki-dark:#6A737D># model : [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>model </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Seq2Seq().to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>criterion </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.CrossEntropyLoss().to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>optimizer </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.optim.Adam(model.parameters(), </span><span style=color:#e36209;--shiki-dark:#FFAB70>lr</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.001</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span></code></pre><p>Sau đây là phần training. Vì giá trị đầu ra là dữ liệu ba chiều nên việc tính toán loss đòi hỏi phải tính toán từng mẫu riêng biệt, do đó có mã vòng for sau đây.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>  for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input_batch, dec_input_batch, dec_output_batch </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> loader:</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # make hidden shape [num_layers * num_directions, batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      h_0 </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.zeros(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, batch_size, n_hidden).to(device)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      (enc_input_batch, dec_intput_batch, dec_output_batch) </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (enc_input_batch.to(device), dec_input_batch.to(device), dec_output_batch.to(device))</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # enc_input_batch : [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # dec_intput_batch : [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # dec_output_batch : [batch_size, n_step+1], not one-hot</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      pred </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model(enc_input_batch, h_0, dec_intput_batch)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # pred : [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      pred </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pred.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># [batch_size, n_step+1(=6), n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      loss </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>      for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(dec_output_batch)):</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>          # pred[i] : [n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>          # dec_output_batch[i] : [n_step+1]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>          loss </span><span style=color:#d73a49;--shiki-dark:#F97583>+=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> criterion(pred[i], dec_output_batch[i])</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>      if</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#d73a49;--shiki-dark:#F97583>%</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1000</span><span style=color:#d73a49;--shiki-dark:#F97583> ==</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>          print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Epoch:'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#005cc5;--shiki-dark:#79B8FF>%04d</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#d73a49;--shiki-dark:#F97583> %</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>), </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'cost ='</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#005cc5;--shiki-dark:#79B8FF>{</span><span style=color:#d73a49;--shiki-dark:#F97583>:.6f</span><span style=color:#005cc5;--shiki-dark:#79B8FF>}</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.format(loss))</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>          </span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      optimizer.zero_grad()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      loss.backward()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      optimizer.step()</span></span>
<span class=line></span></code></pre><p>Như có thể thấy từ mã testing bên dưới, trong quá trình testing, đầu vào của Decoder là một phần giữ chỗ vô nghĩa và độ dài của vị trí bị chiếm giữ là độ dài tối đa <code>n_step</code>. Và tìm vị trí của dấu kết thúc đầu tiên ở đầu ra, chặn tất cả các ký tự trước nó.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Test</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> translate</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(word):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input, dec_input, _ </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> make_data([[word, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'?'</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n_step]])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input, dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input.to(device), dec_input.to(device)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # make hidden shape [num_layers * num_directions, batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    hidden </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.zeros(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, n_hidden).to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    output </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model(enc_input, hidden, dec_input)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # output : [n_step+1, batch_size, n_class]</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    predict </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> output.data.max(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>keepdim</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#6a737d;--shiki-dark:#6A737D># select n_class dimension</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    decoded </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> predict]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    translated </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> ''</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.join(decoded[:decoded.index(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)])</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> translated.replace(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'?'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>''</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'test'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'mans ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'mans'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line></span></code></pre><h2 id=mã-hoàn-chỉnh-như-sau>Mã hoàn chỉnh như sau</h2><p>Phần thực thi bạn có thể xem tại notebook trên kaggle tại <a href="https://www.kaggle.com/code/overvisual/seq2seq-torch?scriptVersionId=145596925" target=_blank rel="nofollow, noopener, noreferrer">https://www.kaggle.com/code/overvisual/seq2seq-torch?scriptVersionId=145596925</a></p><pre class="astro-code astro-code-themes github-dark github-light" data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># code by Tae Hwan Jung(Jeff Jung) @graykode, modify by zhaospei</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.nn </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.utils.data </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Data</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>device </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.device(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'cuda'</span><span style=color:#d73a49;--shiki-dark:#F97583> if</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.cuda.is_available() </span><span style=color:#d73a49;--shiki-dark:#F97583>else</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'cpu'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># S: Symbol that shows starting of decoding input</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># E: Symbol that shows starting of decoding output</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># ?: Symbol that will fill in blank sequence if current batch data size is short than n_step</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>letter </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [c </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> c </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'SE?abcdefghijklmnopqrstuvwxyz'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>letter2idx </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {n: i </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i, n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> enumerate</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(letter)}</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>seq_data </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'women'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'white'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'queen'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'girl'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'boy'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'down'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'high'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'low'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Seq2Seq Parameter</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_step </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> max</span><span style=color:#24292e;--shiki-dark:#E1E4E8>([</span><span style=color:#005cc5;--shiki-dark:#79B8FF>max</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(i), </span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(j)) </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i, j </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq_data]) </span><span style=color:#6a737d;--shiki-dark:#6A737D># max_len(=5)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 128</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(letter2idx) </span><span style=color:#6a737d;--shiki-dark:#6A737D># classfication problem</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>batch_size </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 3</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> make_data</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(seq_data):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input_all, dec_input_all, dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [], [], []</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq_data:</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>            seq[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> '?'</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (n_step </span><span style=color:#d73a49;--shiki-dark:#F97583>-</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(seq[i])) </span><span style=color:#6a737d;--shiki-dark:#6A737D># 'man??', 'women'</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['m', 'a', 'n', '?', '?', 'E']</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'S'</span><span style=color:#d73a49;--shiki-dark:#F97583> +</span><span style=color:#24292e;--shiki-dark:#E1E4E8> seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['S', 'w', 'o', 'm', 'e', 'n']</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_output </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter2idx[n] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (seq[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)] </span><span style=color:#6a737d;--shiki-dark:#6A737D># ['w', 'o', 'm', 'e', 'n', 'E']</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input_all.append(np.eye(n_class)[enc_input])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input_all.append(np.eye(n_class)[dec_input])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_output_all.append(dec_output) </span><span style=color:#6a737d;--shiki-dark:#6A737D># not one-hot</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # make tensor</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.Tensor(enc_input_all), torch.Tensor(dec_input_all), torch.LongTensor(dec_output_all)</span></span>
<span class=line></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>'''</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>enc_input_all: [6, n_step+1 (because of 'E'), n_class]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>dec_input_all: [6, n_step+1 (because of 'S'), n_class]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>dec_output_all: [6, n_step+1 (because of 'E')]</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>'''</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>enc_input_all, dec_input_all, dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> make_data(seq_data)</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>class</span><span style=color:#6f42c1;--shiki-dark:#B392F0> TranslateDataSet</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Data</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Dataset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, enc_input_all, dec_input_all, dec_output_all):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input_all</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_input_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_input_all</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_output_all </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_output_all</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    </span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __len__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self): </span><span style=color:#6a737d;--shiki-dark:#6A737D># return dataset size</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    </span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __getitem__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, idx):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.enc_input_all[idx], </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_input_all[idx], </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.dec_output_all[idx]</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>loader </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Data.DataLoader(TranslateDataSet(enc_input_all, dec_input_all, dec_output_all), batch_size, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Model</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>class</span><span style=color:#6f42c1;--shiki-dark:#B392F0> Seq2Seq</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>nn</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.</span><span style=color:#6f42c1;--shiki-dark:#B392F0>Module</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#005cc5;--shiki-dark:#79B8FF> __init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        super</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(Seq2Seq, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>).</span><span style=color:#005cc5;--shiki-dark:#79B8FF>__init__</span><span style=color:#24292e;--shiki-dark:#E1E4E8>()</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.encoder </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.RNN(</span><span style=color:#e36209;--shiki-dark:#FFAB70>input_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class, </span><span style=color:#e36209;--shiki-dark:#FFAB70>hidden_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden, </span><span style=color:#e36209;--shiki-dark:#FFAB70>dropout</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># encoder</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.decoder </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.RNN(</span><span style=color:#e36209;--shiki-dark:#FFAB70>input_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_class, </span><span style=color:#e36209;--shiki-dark:#FFAB70>hidden_size</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>n_hidden, </span><span style=color:#e36209;--shiki-dark:#FFAB70>dropout</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># decoder</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.fc </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.Linear(n_hidden, n_class)</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> forward</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(self, enc_input, enc_hidden, dec_input):</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # enc_input(=input_batch): [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # dec_inpu(=output_batch): [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        enc_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># enc_input: [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> dec_input.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># dec_input: [n_step+1, batch_size, n_class]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # h_t : [num_layers(=1) * num_directions(=1), batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        _, h_t </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.encoder(enc_input, enc_hidden)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>        # outputs : [n_step+1, batch_size, num_directions(=1) * n_hidden(=128)]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        outputs, _ </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.decoder(dec_input, h_t)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        model </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> self</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.fc(outputs) </span><span style=color:#6a737d;--shiki-dark:#6A737D># model : [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>model </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Seq2Seq().to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>criterion </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> nn.CrossEntropyLoss().to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>optimizer </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.optim.Adam(model.parameters(), </span><span style=color:#e36209;--shiki-dark:#FFAB70>lr</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.001</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>  for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input_batch, dec_input_batch, dec_output_batch </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> loader:</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # make hidden shape [num_layers * num_directions, batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      h_0 </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.zeros(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, batch_size, n_hidden).to(device)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      (enc_input_batch, dec_intput_batch, dec_output_batch) </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (enc_input_batch.to(device), dec_input_batch.to(device), dec_output_batch.to(device))</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # enc_input_batch : [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # dec_intput_batch : [batch_size, n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # dec_output_batch : [batch_size, n_step+1], not one-hot</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      pred </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model(enc_input_batch, h_0, dec_intput_batch)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>      # pred : [n_step+1, batch_size, n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      pred </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pred.transpose(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#6a737d;--shiki-dark:#6A737D># [batch_size, n_step+1(=6), n_class]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      loss </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>      for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(dec_output_batch)):</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>          # pred[i] : [n_step+1, n_class]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>          # dec_output_batch[i] : [n_step+1]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>          loss </span><span style=color:#d73a49;--shiki-dark:#F97583>+=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> criterion(pred[i], dec_output_batch[i])</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>      if</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>) </span><span style=color:#d73a49;--shiki-dark:#F97583>%</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1000</span><span style=color:#d73a49;--shiki-dark:#F97583> ==</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>          print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Epoch:'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#005cc5;--shiki-dark:#79B8FF>%04d</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#d73a49;--shiki-dark:#F97583> %</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (epoch </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>), </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'cost ='</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#005cc5;--shiki-dark:#79B8FF>{</span><span style=color:#d73a49;--shiki-dark:#F97583>:.6f</span><span style=color:#005cc5;--shiki-dark:#79B8FF>}</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.format(loss))</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>          </span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      optimizer.zero_grad()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      loss.backward()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>      optimizer.step()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    </span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Test</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> translate</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(word):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input, dec_input, _ </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> make_data([[word, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>'?'</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#24292e;--shiki-dark:#E1E4E8> n_step]])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    enc_input, dec_input </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> enc_input.to(device), dec_input.to(device)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # make hidden shape [num_layers * num_directions, batch_size, n_hidden]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    hidden </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> torch.zeros(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, n_hidden).to(device)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    output </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model(enc_input, hidden, dec_input)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # output : [n_step+1, batch_size, n_class]</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    predict </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> output.data.max(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>keepdim</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#6a737d;--shiki-dark:#6A737D># select n_class dimension</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    decoded </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [letter[i] </span><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> predict]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    translated </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> ''</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.join(decoded[:decoded.index(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'E'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)])</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> translated.replace(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'?'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#032f62;--shiki-dark:#9ECBFF>''</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'test'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'man'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'mans ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'mans'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'king'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'black'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up ->'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, translate(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'up'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line></span></code></pre><h2 id=tham-khảo>Tham khảo</h2><p>[1] <a href="https://www.kaggle.com/code/overvisual/seq2seq-torch?scriptVersionId=145596925" target=_blank rel="nofollow, noopener, noreferrer">https://www.kaggle.com/code/overvisual/seq2seq-torch?scriptVersionId=145596925</a></p></div></article></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc" style=--primaryColor:#64574D data-astro-cid-bvzihdzo><div class="flex flex-col gap-y-2 border px-3 py-2 relative rounded-xl sm:px-4 sm:py-3"><svg class="opacity-10 absolute end-4 size-20 top-4"><use href=/icons/copyright-sponsor.svg#mingcute-copyright-line></use></svg><div class="flex flex-col"><div class=text-foreground>Triển khai seq2seq với Pytorch</div><div class=text-sm>https://zhaospei.github.io//blog/seq2seq-pytorch</div></div><div class="flex flex-row flex-wrap gap-x-5 gap-y-1 justify-start sm:gap-x-8"><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Author</span> <span class="text-sm max-sm:place-self-center">Tuan-Dung Bui</span></div><div class="flex gap-x-2 sm:flex-col sm:min-w-16"><span class=text-foreground>Update date</span> <span class="text-sm max-sm:place-self-center">October 20, 2023</span></div><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Copyright</span> <a href=https://creativecommons.org/licenses/by/4.0/ class="text-muted-foreground text-sm max-sm:place-self-center" target=_blank>CC BY-NC-SA 4.0</a></div></div><div class=relative><div class="flex flex-row gap-3"><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=copy-link><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-link-2-line></use></svg></button><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=get-qrcode><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-qrcode-2-line></use></svg></button><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=share-weibo><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-weibo-line></use></svg></button></div><div class="transition-all duration-300 ease-in-out *:my-0 -mt-2 absolute aria-expanded:max-h-[256px] aria-expanded:opacity-100 aria-expanded:translate-y-4 bg-primary-foreground border box-content max-h-0 opacity-0 overflow-hidden p-4 rounded-xl z-10" id=qrcode aria-expanded=false></div></div></div><div class="border-t-0 border mx-6 pb-1.5 pt-1 px-3 rounded-b-xl sm:mx-8 sm:px-4"><a href=/projects#sponsorship class="flex justify-between no-underline text-muted-foreground" target=_blank><div>Buy me a cup of coffee ☕.</div><svg class="size-5 m-1"><use href=/icons/copyright-sponsor.svg#mingcute-receive-money-line></use></svg></a></div><script type=module>import QRCode from"/scripts/qrcode.js";const link=window.location.href,copyLink=document.getElementById("copy-link");function loadqrcode(e){if(!e)throw new Error("qrcode container not found");""===e.innerHTML&&new QRCode(e,link)}copyLink?.addEventListener("click",(()=>{navigator.clipboard.writeText(link)}));const getQRCode=document.getElementById("get-qrcode"),qrcodeContainer=document.getElementById("qrcode");if(!qrcodeContainer)throw new Error("qrcode container not found");getQRCode?.addEventListener("click",(()=>{"true"===qrcodeContainer.ariaExpanded?qrcodeContainer.ariaExpanded="false":(loadqrcode(qrcodeContainer),qrcodeContainer.ariaExpanded="true")}));const shareWeibo=document.getElementById("share-weibo");shareWeibo?.addEventListener("click",(()=>{const e=`http://service.weibo.com/share/share.php?url=${link}&title=${document.title}&pic=https://cravatar.cn/avatar/1ffe42aa45a6b1444a786b1f32dfa8aa?s=400`;window.open(e,"_blank")}))</script><div class="mt-3 sm:mt-6 gap-2 grid grid-cols-1 sm:gap-4 sm:grid-cols-2"><a href=/blog/about-this-blog class="flex items-center border-transparent duration-300 group border gap-3 hover:bg-primary-foreground no-underline px-4 py-2 rounded-lg sm:py-4 transition-colors"><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground rotate-180" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg><div class="flex flex-col gap-0.5 grow sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Prev</div><div class="transition-colors font-medium whitespace-nowrap">Welcome to the new world!</div></div></a><a href=/blog/attention-is-all-you-need class="flex items-center border-transparent duration-300 group border gap-3 hover:bg-primary-foreground no-underline px-4 py-2 rounded-lg sm:py-4 transition-colors text-right"><div class="flex flex-col gap-0.5 grow sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Next</div><div class="transition-colors font-medium whitespace-nowrap">Attention is All You Need</div></div><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg></a></div><comment-component data-astro-cid-ksttp56e><div class="mt-3 sm:mt-6 not-prose" id=waline data-astro-cid-ksttp56e>Comment seems to stuck. Try to refresh?✨</div></comment-component></div><button class="flex items-center border-transparent duration-300 group bg-primary-foreground border-2 bottom-8 data-[show=true]:opacity-100 data-[show=true]:translate-y-0 end-4 fixed h-10 hover:border-border/75 justify-center opacity-0 rounded-full sm:end-8 sm:h-12 sm:w-12 text-muted-foreground transition-all translate-y-28 w-10 z-90" id=to-top-btn aria-label="Back to Top" data-show=false><div class="flex items-center justify-center absolute bottom-0 end-0 group-[.ended]:opacity-0 group-hover:opacity-0 start-0 top-0 transition-opacity"><span class=text>10</span> <span class=text-xs>%</span></div><svg class="size-6 group-[.ended]:opacity-100 group-hover:opacity-100 opacity-0 transition-opacity"><use href=/icons/ui.svg#mingcute-up-line></use></svg></button><script>!function(){const e=document.getElementById("to-top-btn"),t=e.children[0].children[0],n=document.getElementById("blog-hero"),o=document.getElementById("content");e.addEventListener("click",(()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})}));new IntersectionObserver((function(t){t.forEach((t=>{e.dataset.show=(!t.isIntersecting).toString()}))})).observe(n);{const n=o.scrollHeight,c=o.offsetTop,d=document.documentElement.clientHeight;document.addEventListener("scroll",(()=>{const o=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;if(!(e<c))return Math.round((e-c)/(n-d)*100)}();void 0!==o&&(t.innerText=o.toString(),e.classList.toggle("ended",o>100))}))}}()</script></div><footer class="w-full mx-auto mt-24"><div class="border-t border-border pt-5"><div class="flex items-center flex-col sm:flex-row gap-y-3 sm:flex sm:gap-y-0 sm:items-center sm:justify-between"><div class="flex items-center flex-col sm:flex-row gap-2 sm:gap-x-4 text-sm"><a href="https://icp.gov.moe/?keyword=APTX4869" class="text-muted-foreground text-xs py-[3px]" target=_blank>ICP - APTX4869</a><p class="">© <samp>2024</samp> Tuan-Dung Bui. All rights reserved.</p></div><div class="flex items-center justify-between"><div class="flex items-center gap-x-4"><a href=https://github.com/zhaospei class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=github><svg class=size-6><use href=/icons/social.svg#mingcute-github-line></use></svg> </a><a href=/rss.xml class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=rss><svg class=size-6><use href=/icons/social.svg#mingcute-rss-2-line></use></svg></a></div></div></div></div></footer></main></body></html>