<!DOCTYPE html><html lang=en-US><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="IE=edge" http-equiv=X-UA-Compatible><title>Attention is All You Need • TDung&#39;s Site</title><link href=/favicon/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon/favicon-32x32.png rel=icon type=image/png sizes=32x32><link href=/favicon/favicon-16x16.png rel=icon type=image/png sizes=16x16><link href=/favicon/site.webmanifest rel=manifest><link href=/fonts/Satoshi-Variable.ttf rel=preload type=font/ttf as=font crossorigin><link href=/fonts/Satoshi-VariableItalic.ttf rel=preload type=font/ttf as=font crossorigin><link href=https://zhaospei.github.io/nlp/2023/10/06/attention-is-all-you-need rel=canonical><meta content="Attention is All You Need • TDung's Site" name=title><meta content="Transformer là mô hình seq2seq được Google Brain đề xuất trong một bài báo xuất bản vào cuối năm 2017" name=description><meta content="Tuan-Dung Bui" name=author><meta content="" name=theme-color><meta content=article property=og:type><meta content="Attention is All You Need" property=og:title><meta content="Transformer là mô hình seq2seq được Google Brain đề xuất trong một bài báo xuất bản vào cuối năm 2017" property=og:description><meta content=https://zhaospei.github.io/nlp/2023/10/06/attention-is-all-you-need property=og:url><meta content="TDung's Site" property=og:site_name><meta content=en_US property=og:locale><meta content=https://zhaospei.github.io/_astro/transformers.B3j2LRDv.jpg property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content="Tuan-Dung Bui" property=article:author><meta content=2023-10-06T08:00:00.000Z property=article:published_time><meta content=summary_large_image property=twitter:card><meta content=https://zhaospei.github.io/nlp/2023/10/06/attention-is-all-you-need property=twitter:url><meta content="Attention is All You Need" property=twitter:title><meta content="Transformer là mô hình seq2seq được Google Brain đề xuất trong một bài báo xuất bản vào cuối năm 2017" property=twitter:description><meta content=https://zhaospei.github.io/_astro/transformers.B3j2LRDv.jpg property=twitter:image><meta content=@cworld0_cn name=telegram:channel><link href=/sitemap-index.xml rel=sitemap><link href=https://zhaospei.github.io/rss.xml rel=alternate type=application/rss+xml title="TDung's Site"><meta content="Astro v4.12.2" name=generator><meta content=https://waline-a0tqnine3-dung-bui-tuans-projects.vercel.app/ name=waline-server-url><link href=/styles/global.css rel=stylesheet><script type=text/partytown src="https://www.googletagmanager.com/gtag/js?id=G-ZXSL3CH9MS" async></script><script type=text/partytown>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZXSL3CH9MS');</script><vercel-speed-insights data-params={&#34;slug&#34;:&#34;attention-is-all-you-need&#34;} data-pathname=/nlp/2023/10/06/attention-is-all-you-need data-props={}></vercel-speed-insights><script>console.log("%c Astro-theme-pure %c https://github.com/cworld1/theme-astro-pure/","color:#fff;background:linear-gradient(90deg,#448bff,#44e9ff);padding:5px 0;","color:#000;background:linear-gradient(90deg,#44e9ff,#ffffff);padding:5px 10px 5px 0px;")</script><link href=/_astro/_slug_.S7CTld6O.css rel=stylesheet><link href=/_astro/_slug_.7J_57pMg.css rel=stylesheet><style>#waline[data-astro-cid-ksttp56e]{--waline-font-size:16px;--waline-white:hsl(var(--background) / var(--tw-bg-opacity));--waline-light-grey:#999;--waline-dark-grey:#666;--waline-theme-color:hsl(var(--foreground) / var(--tw-text-opacity));--waline-active-color:hsl(var(--primary) / var(--tw-text-opacity));--waline-color:hsl(var(--muted-foreground) / var(--tw-text-opacity));--waline-bg-color:hsl(var(--primary-foreground) / var(--tw-bg-opacity));--waline-bg-color-light:hsl(var(--input) / var(--tw-bg-opacity));--waline-bg-color-hover:#f0f0f0;--waline-border-color:hsl(var(--border) / var(--tw-border-opacity));--waline-disable-bg-color:#f8f8f8;--waline-disable-color:#bbb;--waline-code-bg-color:#282c34;--waline-bq-color:#f0f0f0;--waline-avatar-size:3.25rem;--waline-m-avatar-size:calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color:#3498db;--waline-badge-font-size:.775em;--waline-info-bg-color:var(--waline-bg-color-light);--waline-info-color:var(--waline-color);--waline-info-font-size:.625em;--waline-border:1px solid var(--waline-border-color);--waline-avatar-radius:50%;--waline-box-shadow:none}#waline[data-astro-cid-ksttp56e] .wl-reaction-title{display:none!important}#waline[data-astro-cid-ksttp56e] .wl-reaction{overflow:visible}@media (max-width:640px){#waline[data-astro-cid-ksttp56e] .wl-card-item{padding:0!important}#waline[data-astro-cid-ksttp56e] .wl-cards .wl-user{margin-inline-end:.45em}}</style><style>.highlight{color:var(--primaryColor)!important}.highlight-bg{background-color:var(--primaryColor)!important}#content[data-astro-cid-san3gjmf] h2:target:before,#content[data-astro-cid-san3gjmf] h3:target:before{display:inline-block;content:"#";margin-inline-start:-30px;width:30px}#content[data-astro-cid-san3gjmf] blockquote{position:relative;overflow:hidden}#content[data-astro-cid-san3gjmf] blockquote:after{position:absolute;content:"”";top:-5.4rem;right:0;font-size:10rem;font-family:Trebuchet MS,Lucida Sans Unicode,Lucida Grande,Lucida Sans,Arial,sans-serif;transform:rotate(-15deg);opacity:5%}</style><script type=module src=/_astro/hoisted.TUYaxBBN.js></script><script type=module src=/_astro/page.DFwqf4PB.js></script><script>!function(t,e,n,r){(window.crossOriginIsolated||navigator.serviceWorker)&&((r=t[e]=Object.assign(t[e]||{},{lib:"/~partytown/",debug:!1}))[n]=(r[n]||[]).concat(["dataLayer.push"]))}(window,"partytown","forward");const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,y){function f(){y||(y=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(h,1e4),r.addEventListener("pt0",b),a?w(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?w():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&w()}))}),console.error):h())))}function w(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function h(n,o){for(b(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function b(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?f():(t.addEventListener("DOMContentLoaded",f),t.addEventListener("load",f))}(window,document,navigator,top,window.crossOriginIsolated),document.addEventListener("astro:before-swap",(t=>{let e=document.body.querySelector("iframe[src*='/~partytown/']");e&&t.newDocument.body.append(e)}))</script></head><body class="flex bg-background justify-center"><div class="w-full absolute start-0 z-0 h-1/2 opacity-25 pointer-events-none top-0" style=background-image:linear-gradient(#64574d,transparent)></div><script>const lightModePref=window.matchMedia("(prefers-color-scheme: light)");function getUserPref(){return localStorage.getItem("theme")||(lightModePref.matches?"light":"dark")}function setTheme(e,t=!1){if(!["light","dark"].includes(e))return void console.log(`Invalid theme value '${e}' received. Expected 'light' or 'dark'.`);t&&localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark","dark"===e);const r="dark"===e?"#0B0B10":"#FCFCFD";document.querySelector('meta[name="theme-color"]')?.setAttribute("content",r)}setTheme(getUserPref()),document.addEventListener("astro:after-swap",(()=>setTheme(getUserPref()))),document.addEventListener("theme-change",(e=>{const t=e.detail.theme;localStorage.setItem("theme",t),setTheme(e.detail.theme,!0)})),lightModePref.addEventListener("change",(e=>{setTheme(e.matches?"light":"dark")}))</script><main class="flex items-center flex-col leading-relaxed lg:px-10 max-w-[60rem] min-h-screen pb-10 px-4 sm:px-7 text-[0.92rem] w-screen z-10"><header-component class="transition-all py-1 border group [&#38;.not-top]:bg-background [&#38;.not-top]:border-border border-transparent box-content dark:[&#38;.not-top]:bg-primary-foreground duration-300 mb-16 rounded-xl sm:rounded-2xl sticky top-4 w-full z-30" data-astro-cid-qlfjksao><header class="flex flex-wrap sm:flex-nowrap sm:justify-start text-sm" data-astro-cid-qlfjksao><nav aria-label=global class="flex items-center justify-between mx-auto relative sm:flex sm:items-center w-full" data-astro-cid-qlfjksao><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] !duration-0 -top-8 h-20 max-sm:group-[.expanded]:bg-white" data-astro-cid-qlfjksao></div><a href=/ class="transition-all duration-300 flex-none font-semibold group-[.not-top]:ms-3 sm:group-[.not-top]:ms-5 text-xl" aria-label=Brand data-astro-cid-qlfjksao>TDung&#39;s Site</a><div class="flex gap-x-4 sm:gap-x-6" data-astro-cid-qlfjksao><div class="transition-all duration-300 dark:group-[.expanded.not-top]:bg-primary-foreground end-0 grid group-[.expanded]:opacity-100 group-[.not-top]:rounded-xl max-md:border-b max-sm:absolute max-sm:group-[.expanded]:bg-background max-sm:group-[.not-top]:border max-sm:group-[.not-top]:pb-2 max-sm:group-[.not-top]:pt-2 max-sm:group-[.not-top]:px-4 max-sm:opacity-0 max-sm:pb-4 max-sm:pt-0 sm:border-0 sm:grid-rows-1 start-0 top-12 z-20" data-astro-cid-qlfjksao id=headerExpandConetent><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] bg-white h-full max-md:border-b top-0" data-astro-cid-qlfjksao></div><div class="transition-colors flex items-center flex-col gap-x-5 gap-y-2 justify-center overflow-hidden sm:flex-row sm:gap-x-7" data-astro-cid-qlfjksao><a href=/blog class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Blog </a><a href=/projects class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Projects </a><a href=/links class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Links </a><a href=/about class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>About</a><div class="flex flex-row gap-x-3 grow justify-end sm:gap-x-5 sm:w-fit w-full" data-astro-cid-qlfjksao><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="px-1 py-2" data-astro-cid-qlfjksao title=Travelling><span class=sr-only data-astro-cid-qlfjksao>Travelling</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-train-2-line data-astro-cid-qlfjksao></use></svg> </a><a href=/search class="px-1 py-2" data-astro-cid-qlfjksao title=Search><span class=sr-only data-astro-cid-qlfjksao>Search</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-search-2-line data-astro-cid-qlfjksao></use></svg></a></div></div></div><div class="transition-all gap-x-4 flex group-[.not-top]:gap-x-2 group-[.not-top]:me-1.5" data-astro-cid-qlfjksao><button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl group/dark" id=toggleDarkMode data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Dark Theme</span> <svg class="transition-all group-hover/dark:text-primary size-5 dark:hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-sun-line data-astro-cid-qlfjksao></use></svg> <svg class="transition-all group-hover/dark:text-primary size-5 dark:block hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-moon-stars-line data-astro-cid-qlfjksao></use></svg></button> <button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl sm:hidden" id=toggleMenu data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Menu</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-menu-line data-astro-cid-qlfjksao></use></svg></button></div></div></nav></header></header-component><div class=w-full style=--primaryColor:#64574D data-astro-cid-san3gjmf><a href=/blog class="transition-all py-1 border group bg-primary-foreground border-border gap-x-1 hover:bg-input inline-flex items-center no-underline px-2 rounded-lg text-muted-foreground text-sm" data-astro-cid-san3gjmf data-astro-prefetch><svg class="group-hover:stroke-primary stroke-muted-foreground" height=16 viewBox="0 0 24 24" width=16 fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2.5 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:scale-x-100 scale-x-0 group-hover:translate-x-0 translate-x-3" x1=19 x2=5 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-0 translate-x-1" points="12 19 5 12 12 5"></polyline></svg><p class=my-0>Back</p></a><div class="gap-x-10 lg:flex lg:items-start mt-8" style=--primaryColor:#64574D data-astro-cid-san3gjmf><aside class="animate -me-24 basis-60 max-lg:hidden order-2 sticky top-[15%]"><toc-heading><h2 class=font-semibold>TABLE OF CONTENTS</h2><ul class="max-h-[70vh] mt-4 overflow-y-scroll text-card-foreground"><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#self-attention class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Self-Attention">Self-Attention</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#encoder class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Encoder">Encoder</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#position-wise-fully-connected-feed-forward-network class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: position-wise fully connected feed-forward network">position-wise fully connected feed-forward network</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#residual-connection class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: residual connection">residual connection</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#batch-norm-và-layer-norm class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Batch Norm và Layer Norm">Batch Norm và Layer Norm</a></div></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#toàn-bộ-kiến-trúc-encoder class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Toàn bộ kiến trúc Encoder">Toàn bộ kiến trúc Encoder</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#input--positional-embedding class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: input &#38; positional embedding">input &amp; positional embedding</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#multi-head-attention class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: multi-head attention">multi-head attention</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#add--norm class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: add &#38; norm">add &amp; norm</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#feed-forward class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: feed forward">feed forward</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#add--norm-1 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: add &#38; norm">add &amp; norm</a></div></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#decoder class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Decoder">Decoder</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#word-embedding-và-positional-embedding class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Word Embedding và Positional Embedding">Word Embedding và Positional Embedding</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#word-embedding class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Word Embedding">Word Embedding</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#positional-embedding class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Positional Embedding">Positional Embedding</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#nhúng-vị-trí-tùy-chinh class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Nhúng vị trí tùy chinh">Nhúng vị trí tùy chinh</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#nhúng-từ-vị-trí-lý-tuởng class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Nhúng từ vị trí “lý tuởng”">Nhúng từ vị trí “lý tuởng”</a></div></li></ul></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#q--a class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Q &#38; A">Q &amp; A</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#tại-sao-transformer-cần-multi-head-attention class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Tại sao Transformer cần Multi-head Attention ?">Tại sao Transformer cần Multi-head Attention ?</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#ưu-điểm-của-transformer-so-với-rnnlstm-là-gì-tại-sao class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Ưu điểm của Transformer so với RNN/LSTM là gì? Tại sao?">Ưu điểm của Transformer so với RNN/LSTM là gì? Tại sao?</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#tại-sao-transformer-có-thể-thay-thế-seq2seq class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: Tại sao Transformer có thể thay thế seq2seq?">Tại sao Transformer có thể thay thế seq2seq?</a></div></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#tham-khảo class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: Tham khảo">Tham khảo</a></div></li></ul></toc-heading></aside><article class="break-words flex-grow" data-astro-cid-san3gjmf data-pagefind-body style=flex-grow:3;flex-shrink:1;flex-basis:60%;--primaryColor:#64574D><div style=--primaryColor:#64574D data-astro-cid-san3gjmf id=blog-hero><div class="relative animate hero-image max-lg:mx-auto mb-6 prose"><img alt="Attention is All You Need" decoding=async height=1545 loading=eager src=/_astro/transformers.B3j2LRDv_ZgLenq.webp width=2742 class="relative w-full cover-image h-auto object-contain rounded-2xl z-10" fetchpriority=high inferSize=true><img alt="Attention is All You Need" decoding=async height=1545 loading=eager src=/_astro/transformers.B3j2LRDv_ZgLenq.webp width=2742 class="duration-300 absolute blur-xl h-full mt-0 opacity-40 start-0 top-4 transition-opacity w-full z-0" fetchpriority=high inferSize=true id=blurImage></div><div class="animate max-lg:mx-auto article-info max-w-[65ch]"><div class="flex flex-wrap gap-x-4 gap-y-2 leading-6 text-muted-foreground text-xs"><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-calendar-2-line></use></svg> <samp class=text-muted-foreground><time datetime=2023-10-06T08:00:00.000Z>Oct 6, 2023</time></samp></div><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-time-line></use></svg> 11 min read</div><span class="flex items-center gap-1"><svg class=size-5><use href=/icons/project.svg#mingcute-earth-2-line></use></svg> Vietnamese</span></div><h1 class="font-medium mt-4 sm:mb-2 sm:mt-6 sm:text-3xl text-2xl">Attention is All You Need</h1><div class="flex items-center flex-row flex-wrap gap-x-1 mt-3 sm:mt-5"><svg class=size-5><use href=/icons/ui.svg#mingcute-tag-line></use></svg><div><a href=/tags/nlp/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag nlp" data-pagefind-filter=tag>nlp </a>,</div><div><a href=/tags/paper/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag paper" data-pagefind-filter=tag>paper </a>,</div><div><a href=/tags/model/ class="inline-block before:content-['#'] hover:underline hover:underline-offset-4" aria-label="View more blogs with the tag model" data-pagefind-filter=tag>model</a></div></div><div class="mt-3 italic"><blockquote class="text-muted-foreground text-sm"><q>Transformer là mô hình seq2seq được Google Brain đề xuất trong một bài báo xuất bản vào cuối năm 2017</q></blockquote><div class="text-muted-foreground text-sm mt-1"><span class=waline-pageview-count data-path=/nlp/2023/10/06/attention-is-all-you-need/ ></span> views | <span class=waline-comment-count data-path=/nlp/2023/10/06/attention-is-all-you-need/ ></span> comments</div></div></div><div class="sm:mt-6 mt-4 border-t max-lg:mx-auto sm:w-1/3 w-1/2"></div></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc animate max-lg:mx-auto" style=--primaryColor:#64574D data-astro-cid-san3gjmf id=content><div class="markdown-alert markdown-alert-note" dir=auto><p class=markdown-alert-title dir=auto><svg class=octicon height=16 viewBox="0 0 16 16" width=16 aria-hidden=true><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>NOTE</p><p><code>Transformer</code> là mô hình seq2seq được Google Brain đề xuất trong một bài báo xuất bản vào cuối năm 2017. Giờ đây, nó đã đạt được nhiều ứng dụng và tiện ích mở rộng và <code>BERT</code> là mô hình ngôn ngữ được đào tạo trước có nguồn gốc từ Transformer.</p></div><p>Việc đào tạo <code>RNN</code> truyền thống là nối tiếp và nó phải đợi từ hiện tại được xử lý trước khi có thể xử lý từ tiếp theo. Transformer được huấn luyện song song, tức là tất cả các từ đều được huấn luyện cùng một lúc, điêu này làm tăng đáng kể hiệu quả tính toán.</p><img alt="Kiến trúc mô hình Transformer" decoding=async height=718 loading=lazy src=/_astro/transformer-model-architecture.E6nIDWI__16AhAK.webp width=466><h2 id=self-attention>Self-Attention</h2><p><code>Scaled Dot-Product Attention</code> là tích chấm chuẩn hóa Attention, chi tiết cụ thể được thể hiện trong hình.</p><img alt="" decoding=async height=1080 loading=lazy src=/_astro/attention.C6TIG6U__Z2nKLzl.webp width=1920> <span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=false>(</mo><mi>Q</mi><mo separator=true>,</mo><mi>K</mi><mo separator=true>,</mo><mi>V</mi><mo stretchy=false>)</mo><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=false>(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy=false>)</mo><mi>V</mi></mrow><annotation encoding=application/x-tex>Attention(Q,K,V)=softmax(\dfrac{QK^T}{\sqrt{d_k}})V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">Q</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:2.4483em;vertical-align:-.93em></span><span class="mord mathnormal">so</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class=mopen>(</span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.5183em><span style=top:-2.2528em><span class=pstrut style=height:3em></span><span class=mord><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8572em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span><span style=top:-2.8172em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg height=1.08em viewBox="0 0 400000 1080" width=400em xmlns=http://www.w3.org/2000/svg preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1828em><span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">Q</span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.93em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose>)</span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span></span><p>Sự chú ý của nhiều đầu vào sử dụng nhiều bộ trọng số (<code>weights</code>) (<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>W</mi><mi>q</mi></msub><mo separator=true>,</mo><msub><mi>W</mi><mi>k</mi></msub><mo separator=true>,</mo><msub><mi>W</mi><mi>v</mi></msub></mrow><annotation encoding=application/x-tex>W_q,W_k,W_v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>), ghép lại cho ra kết quả cuối cùng.</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>H</mi><mi>e</mi><mi>a</mi><mi>d</mi><mo stretchy=false>(</mo><mi>Q</mi><mo separator=true>,</mo><mi>K</mi><mo separator=true>,</mo><mi>V</mi><mo stretchy=false>)</mo><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy=false>(</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mn>1</mn></msub><mo separator=true>,</mo><mi mathvariant=normal>.</mi><mi mathvariant=normal>.</mi><mi mathvariant=normal>.</mi><mo separator=true>,</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mi>h</mi></msub><mo stretchy=false>)</mo><msup><mi>W</mi><mi>O</mi></msup></mrow><annotation encoding=application/x-tex>MultiHead(Q,K,V)=Concat(head_1,...,head_h)W^O</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10903em>M</span><span class="mord mathnormal">u</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">i</span><span class="mord mathnormal">He</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class=mopen>(</span><span class="mord mathnormal">Q</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.1413em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class=mopen>(</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>...</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">h</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.02778em>O</span></span></span></span></span></span></span></span></span></span></span></span><p>trong đó</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mi>i</mi></msub><mo>=</mo><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=false>(</mo><mi>Q</mi><msubsup><mi>W</mi><mi>i</mi><mi>Q</mi></msubsup><mo separator=true>,</mo><mi>K</mi><msubsup><mi>W</mi><mi>i</mi><mi>K</mi></msubsup><mo separator=true>,</mo><mi>V</mi><msubsup><mi>W</mi><mi>i</mi><mi>V</mi></msubsup><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>head_i=Attention(QW^Q_i,KW^K_i,VW^V_i)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.2361em;vertical-align:-.2769em></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">Q</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.9592em><span style=top:-2.4231em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.1809em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">Q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2769em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.453em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.07153em>K</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8913em><span style=top:-2.453em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">i</span></span></span><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.22222em>V</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span><p>Trong đó <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>h</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding=application/x-tex>h = 8</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal">h</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>8</span></span></span></span>, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>d</mi><mi>q</mi></msub><mo>=</mo><msub><mi>d</mi><mi>k</mi></msub><mo>=</mo><msub><mi>d</mi><mi>v</mi></msub><mo>=</mo><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mi mathvariant=normal>/</mi><mn>4</mn><mo>=</mo><mn>64</mn></mrow><annotation encoding=application/x-tex>d_q=d_k=d_v=d_{model}/4=64</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9805em;vertical-align:-.2861em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord>/4</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>64</span></span></span></span>.</p><h2 id=encoder>Encoder</h2><p>Encoder được xếp chồng lên nhau bởi sáu lớp giống hệt nhau, mỗi lớp bao gồm hai lớp con - cơ chế tự chú ý nhiều đầu (<code>multi-head self-attention mechanism</code>) và mạng nơ ron vị trí chuyển tiếp được kết nối đầy đủ (<code>position-wise fully connected feed-forward network</code>). Mỗi lớp con sử dụng các kết nối dư (<code>residual connection</code>) và lớp chuẩn hóa (<code>layer normalization</code>). Kích thước đầu ra của các lớp con là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo>=</mo><mn>512</mn></mrow><annotation encoding=application/x-tex>d_{model} = 512</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.6444em></span><span class=mord>512</span></span></span></span>.</p><p>Đầu ra của lớp con có thể được biểu diễn dưới dạng:</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=false>(</mo><mi>x</mi><mo>+</mo><mi>S</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mo stretchy=false>(</mo><mi>x</mi><mo stretchy=false>)</mo><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>LayerNorm(x+Sublayer(x))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>yer</span><span class="mord mathnormal" style=margin-right:.10903em>N</span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class="mord mathnormal">m</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>yer</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mclose>))</span></span></span></span></span><h3 id=position-wise-fully-connected-feed-forward-network>position-wise fully connected feed-forward network</h3><p>Mạng nơ-ron chuyển tiếp được kết nối đầy đủ (<code>position-wise fully connected feed-forward network</code>) bao gồm hai phép biến đổi tuyến tính với kích hoạt <code>ReLU</code> ở giữa.</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>F</mi><mi>F</mi><mi>N</mi><mo stretchy=false>(</mo><mi>x</mi><mo stretchy=false>)</mo><mo>=</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy=false>(</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy=false>)</mo><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>FFN(x)=ReLU(xW_1+b_1)W_2+b_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.10903em>FFN</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10903em>LU</span><span class=mopen>(</span><span class="mord mathnormal">x</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span><p>Kích thước lớp bên trong (inner-layer) là 2048.</p><h3 id=residual-connection>residual connection</h3><p>Mạng dư (<code>Residual Network</code>), các kết nối tắt có khả năng bỏ qua một hoặc nhiều lớp, do sự tồn tại của kết nối tắt nên hiệu suất của mạng sâu (có nhiều lớp) không kém hơn so với các mạng nông (mạng có ít lớp). Phương pháp này giải quyết vấn đề suy thoái do các lớp chập xếp chồng lên nhau gây ra, số lượng lớp của mạng nơ-ron tích chập đã được tăng lên rất nhiều lên hàng trăm lớp, và cải thiện đáng kể hiệu suất của mạng thần kinh tích chập (<code>resnet</code>).</p><img alt="" decoding=async height=263 loading=lazy src=/_astro/resnet.niD7322s_Z2lmze.webp width=464><h3 id=batch-norm-và-layer-norm>Batch Norm và Layer Norm</h3><img alt="" decoding=async height=221 loading=lazy src=/_astro/normalization.CKdwKCEK_Z1luCLL.webp width=409><p>Đặt kích thước hình ảnh đầu vào là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo stretchy=false>[</mo><mi>N</mi><mo separator=true>,</mo><mi>C</mi><mo separator=true>,</mo><mi>H</mi><mo separator=true>,</mo><mi>W</mi><mo stretchy=false>]</mo></mrow><annotation encoding=application/x-tex>[N, C, H, W]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class="mord mathnormal" style=margin-right:.10903em>N</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.08125em>H</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mclose>]</span></span></span></span>:</p><ul><li><code>Batch Norm</code>, chuẩn hóa theo từng batch NHW, là để chuẩn hóa đầu vào từng kênh đơn, đều này không hiệu quả đối với <code>batch-size</code> nhỏ.</li><li><code>Layer Norm</code>, chuẩn hóa theo từng layer CHW, là để chuẩn hóa đầu vào ở mỗi độ sâu, chủ yếu có tác dụng rõ ràng trên RNN.</li></ul><p>Sự hiểu biết cá nhân:</p><ul><li>Dành cho CNN, nếu hạt nhân tích chập quét hình ảnh đầu vào, nó được tính là thao tác tích chập, cần có tổng thao tác batchsize. Do đó, chuẩn hóa cần được thực hiện theo batch.</li><li>Dành cho RNN, batchsize thường là 1, số vòng lặp là số độ dài đầu vào (số channel). Do đó, chuẩn hóa cần được thực hiện theo channel.</li></ul><h2 id=toàn-bộ-kiến-trúc-encoder>Toàn bộ kiến trúc Encoder</h2><h3 id=input--positional-embedding>input &#x26; positional embedding</h3><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>X</mi><mo>=</mo><mi>E</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>−</mo><mi>L</mi><mi>o</mi><mi>o</mi><mi>k</mi><mi>u</mi><mi>p</mi><mo stretchy=false>(</mo><mi>X</mi><mo stretchy=false>)</mo><mo>+</mo><mi>P</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>−</mo><mi>E</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding=application/x-tex>X=Embedding-Lookup(X)+Positional-Encoding</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class="mord mathnormal">mb</span><span class="mord mathnormal">e</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.03588em>g</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style=margin-right:.03148em>k</span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.7778em;vertical-align:-.0833em></span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class="mord mathnormal">os</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">na</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class="mord mathnormal">n</span><span class="mord mathnormal">co</span><span class="mord mathnormal">d</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.03588em>g</span></span></span></span></span><h3 id=multi-head-attention>multi-head attention</h3><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>Q</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>q</mi></msub><mo stretchy=false>(</mo><mi>X</mi><mo stretchy=false>)</mo><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>q</mi></msub></mrow><annotation encoding=application/x-tex>Q=Linear_q(X)=XW_q</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8778em;vertical-align:-.1944em></span><span class="mord mathnormal">Q</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.9694em;vertical-align:-.2861em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span></span></span></span></span> <span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>K</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>q</mi></msub><mo stretchy=false>(</mo><mi>X</mi><mo stretchy=false>)</mo><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding=application/x-tex>K=Linear_q(X)=XW_k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span> <span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>V</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>v</mi></msub><mo stretchy=false>(</mo><mi>X</mi><mo stretchy=false>)</mo><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>v</mi></msub></mrow><annotation encoding=application/x-tex>V=Linear_v(X)=XW_v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03588em>v</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span> <span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>X</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mi>S</mi><mi>e</mi><mi>l</mi><mi>f</mi><mo>−</mo><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=false>(</mo><mi>Q</mi><mo separator=true>,</mo><mi>K</mi><mo separator=true>,</mo><mi>V</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>X_{attention}=Self-Attention(Q,K,V)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.05764em>S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.01968em>l</span><span class="mord mathnormal" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">Q</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span><span class=mclose>)</span></span></span></span></span><h3 id=add--norm>add &#x26; norm</h3><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>X</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=false>(</mo><mi>X</mi><mo>+</mo><msub><mi>X</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>X_{attention}=LayerNorm(X+X_{attention})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>yer</span><span class="mord mathnormal" style=margin-right:.10903em>N</span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class="mord mathnormal">m</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span><h3 id=feed-forward>feed forward</h3><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>X</mi><mrow><mi>h</mi><mi>i</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>n</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo stretchy=false>(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy=false>(</mo><mi>L</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo stretchy=false>(</mo><msub><mi>X</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo stretchy=false>)</mo><mo stretchy=false>)</mo><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>X_{hidden}=Linear(ReLU(Linear(X_{attention})))</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">hi</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style=margin-right:.10903em>LU</span><span class=mopen>(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">in</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)))</span></span></span></span></span><h3 id=add--norm-1>add &#x26; norm</h3><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>X</mi><mrow><mi>h</mi><mi>i</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>n</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy=false>(</mo><msub><mi>X</mi><mrow><mi>h</mi><mi>i</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>X</mi><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>X_{hidden}=LayerNorm(X_{hidden}+X_{attention})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">hi</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style=margin-right:.02778em>yer</span><span class="mord mathnormal" style=margin-right:.10903em>N</span><span class="mord mathnormal" style=margin-right:.02778em>or</span><span class="mord mathnormal">m</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">hi</span><span class="mord mathnormal mtight">dd</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>X</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">tt</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span><p><code>multi-head attention</code> trong <code>Encoder</code> là một cơ chế tự chú ý (<code>self-attention mechanism</code>). <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>k</mi></mrow><annotation encoding=application/x-tex>k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span>, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>q</mi></mrow><annotation encoding=application/x-tex>q</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.4306em></span><span class="mord mathnormal" style=margin-right:.03588em>v</span></span></span></span> trong cơ chế tự chú ý đều xuất phát từ cùng một vị trí, mỗi lớp của Encoder có thể nhận được tất cả vị trí của lớp trước.</p><h2 id=decoder>Decoder</h2><p>Decoder bao gồm sáu lớp giống hệt xếp chồng lên nhau; trong Multi-head Attention, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>q</mi></mrow><annotation encoding=application/x-tex>q</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.03588em>q</span></span></span></span> được đến từ lớp trước đó của Decoder, k và v đến từ đầu ra của Encoder. Điều cho phép mỗi vị trí trong Decoder nhận biết được tất cả các vị trí của chuỗi đầu vào.</p><p>Ngoài hai lớp con trong Encoder, Decoder thêm một lớp con mới xử lý đầu ra của Encoder - <code>masked multi-head self-attention mechanism</code>. Encoder trong seq2seq truyền thống sử dụng mô hình RNN, vì vậy nếu các từ tại thời điểm t được nhập vào trong quá trình huấn luyện thì mô hình sẽ không thể nhìn thấy các từ trước đó vào các thời điểm trong tương lai, bởi vì RNN hoạt động theo thời gian và chỉ khi thao tác tại thời điểm t hoàn thành, chỉ khi đó ta mới có thể nhìn thấy các từ tại thời điểm t + 1. Và Transformer Decoder đã không sử dụng RNN, thay đổi sang Self-Attention, điều này tạo ra một vấn đề, trong quá trình huấn luyện, toàn bộ ground truth đã được hiển thị với Decoder, điều này rõ ràng là sai, chúng ta cần phải thực hiện một số xử lý trên đầu vào của Decoder, quá trình này được gọi là <code>Mask</code> - Đặt tất cả các giá trị sau postion thành <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo>−</mo><mi mathvariant=normal>∞</mi></mrow><annotation encoding=application/x-tex>-\infty</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6667em;vertical-align:-.0833em></span><span class=mord>−</span><span class=mord>∞</span></span></span></span> trước khi vào softmax.</p><p>Ví dụ, ground truth của Decoder là “&#x3C;start> I am fine”, chúng ta cho câu này vào bộ Decoder, sau khi Word Embedding và Positional Encoding, thực hiện phép biến đổi tuyến tính bậc 3 trên ma trận thu được <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo stretchy=false>(</mo><msub><mi>W</mi><mi>Q</mi></msub><mo separator=true>,</mo><msub><mi>W</mi><mi>K</mi></msub><mo separator=true>,</mo><msub><mi>W</mi><mi>V</mi></msub><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>(W_Q,W_K,W_V)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0361em;vertical-align:-.2861em></span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight">Q</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2861em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.07153em>K</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.22222em>V</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span> Sau đó thực hiện self-attention, trước tiên, nhận Scaled Scores thông qua <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mstyle displaystyle=true scriptlevel=0><mfrac><mrow><mi>Q</mi><mo>×</mo><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac></mstyle></mrow><annotation encoding=application/x-tex>\dfrac{Q×K^T}{\sqrt{d_k}}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.4483em;vertical-align:-.93em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.5183em><span style=top:-2.2528em><span class=pstrut style=height:3em></span><span class=mord><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.8572em><span class=svg-align style=top:-3em><span class=pstrut style=height:3em></span><span class=mord style=padding-left:.833em><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span><span style=top:-2.8172em><span class=pstrut style=height:3em></span><span class=hide-tail style=min-width:.853em;height:1.08em><svg height=1.08em viewBox="0 0 400000 1080" width=400em xmlns=http://www.w3.org/2000/svg preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1828em><span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">Q</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:.2222em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>K</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8413em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mathnormal mtight" style=margin-right:.13889em>T</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.93em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, bước tiếp theo rất quan trọng, chúng ta cần mask theo Scaled Scores, ví dụ, khi nhập “I”, hiện tại mô hình chỉ biết thông tin của tất cả các từ trước đó của “I”, tức thông tin của “&#x3C;start>” và “I”, không được phép biết được thông tin của các từ sau “I”. Lý do rất đơn giản, khi dự đoán là chúng ta dự đoán theo thứ tự từng chữ, làm sao có thể biết được thông tin của những từ sau trước khi dự đoán xong từ này? Mask rất đơn giản, đầu tiên tạo một ma trận có tam giác hoàn toàn phía dưới bằng 0 và tam giác hoàn tòan phía trên bằng âm vô cùng, sau đó chỉ cần thêm nó vào Scaled Scores.</p><h2 id=word-embedding-và-positional-embedding>Word Embedding và Positional Embedding</h2><h3 id=word-embedding>Word Embedding</h3><p>Phần nhúng từ sử dụng nhúng từ có thể học được, kích thước của nó là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding=application/x-tex>d_{model}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>. Hình thức mã hóa <code>One-hot</code> ngắn gọn, nhưng quá thưa thớt, nó không phản ánh sự giống nhau về nghĩa của từ. Vì vậy hãy sử dụng <code>the Skip-Gram Model</code> hoặc <code>continuous bag of words model</code> hoặc các nhúng từ khác có thể học được khác.</p><h3 id=positional-embedding>Positional Embedding</h3><p>Bởi vì mô hình không bao gồm các cấu trúc tuần hoàn, vì vậy nắm bắt được các thông tin thứ tự tuần tự, ví dụ nếu <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>K</mi></mrow><annotation encoding=application/x-tex>K</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.07153em>K</span></span></span></span> và <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>V</mi></mrow><annotation encoding=application/x-tex>V</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.22222em>V</span></span></span></span> được xóa trộn theo từng hàng thì kết quả sau Attention sẽ giống nhau. Tuy nhiên, thông tin tuần tự rất quan trọng và thể hiện cấu trúc toàn cầu, do đó thông tin position tuyệt đối và tương đối của token tuần tự phải được sử dụng.</p><h4 id=nhúng-vị-trí-tùy-chinh>Nhúng vị trí tùy chinh</h4><p>Một ý tưởng là lấy một số trong khoảng <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo stretchy=false>[</mo><mn>0</mn><mo separator=true>,</mo><mn>1</mn><mo stretchy=false>]</mo></mrow><annotation encoding=application/x-tex>[0, 1]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.1667em></span><span class=mord>1</span><span class=mclose>]</span></span></span></span> và gán nó cho mỗi từ, trong đó 0 được trao cho từ đầu tiên, 1 cho từ cuối cùng, công thức cụ thể là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>P</mi><mi>E</mi><mo>=</mo><mstyle displaystyle=true scriptlevel=0><mfrac><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mrow><mi>T</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mstyle></mrow><annotation encoding=application/x-tex>PE=\dfrac{pos}{T−1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6833em></span><span class="mord mathnormal" style=margin-right:.05764em>PE</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.8769em;vertical-align:-.7693em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.1076em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>T</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span><span class=mord>1</span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.7693em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>. Vấn đề của việc gán theo công thức này là nó bị phụ thuộc và kích thước của văn bản. Tức là văn bản có số kí tự là 30. Khi đó theo công thức trên, thì khoảng cách giữa hai từ sẽ là 0.0333. Khi văn bản khác có số lượng kí từ &#x3C; 30, thì con số 0.0333 vẫn mô tả đúng vị trí tương đối giữa chúng, tuy nhiên với văn bản > 30, ví dụ 90 thì 0.0333 đang gộp khoảng cách thực tế đang được phân tách bởi hai ký tự. Điều này rõ ràng là không phù hợp, vì sự khác biệt giống nhau không có nghĩa là giống nhau trong các câu khác nhau.</p><p>Một ý tưởng khác là gắn tuyến tính mỗi bước theo thời gian, nghĩa là từ đầu tiên được gán là 1, từ thứ hai được gán là 2, … Phương pháp này cũng có những vấn đề lớn: 1. Nó lớn hơn giá trị nhúng từ thông từ, có thể gây nhiễu cho mô hình; 2. Ký tự cuối cùng lớn hơn nhiều ký tự đầu tiên, sau khi hợp nhất với các từ nhúng, giá trị của các đặc trưng sẽ bị sai lệch.</p><h4 id=nhúng-từ-vị-trí-lý-tuởng>Nhúng từ vị trí “lý tuởng”</h4><p>Một lý tưởng là thiết kế nhúng vị trí phải đáp ứng những tiêu chí sau:</p><ul><li>Nó sẽ xuất ra mã hóa duy nhất cho mỗi từ.</li><li>Sự khác biệt giữa hai từ phải nhất quán giữa các câu có độ dài khác nhau.</li><li>Giá trị của nó phải được giới hạn.</li></ul><p>Do đó việc nhúng vị trí sin và cosin đã được sử dụng cho Transformer.</p><p>Bây giờ hãy định nghĩa lại Positional Embedding, kích thước của việc nhúng vị trí là <code>[max_sequence_length, embedding_dimension]</code>, kích thước của phần nhúng vị trí giống với kích thước của vector từ, đều bằng <code>embedding_dimension</code>. <code>max_sequence_length</code> là một hyperparameter, đề cập đến số lượng tối đa mà một câu bao gồm.</p><p>Kích thước của việc nhúng vị trí cũng giống như kích thước của việc nhúng từ, cùng là <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding=application/x-tex>d_{model}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>. Công thước tính toán của nó là:</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy=false>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator=true>,</mo><mn>2</mn><mi>i</mi><mo stretchy=false>)</mo></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=false>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant=normal>/</mi><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant=normal>/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>PE_{(pos,2i)}=sin(pos/10000^{2i/d_{model}})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0385em;vertical-align:-.3552em></span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3448em><span style=top:-2.5198em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mtight mopen">(</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span><span class="mtight mpunct">,</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mtight mclose">)</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3552em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.188em;vertical-align:-.25em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class=mord>/1000</span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.938em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3448em><span style=top:-2.3488em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="mtight sizing reset-size3 size1"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1512em><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span> <span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mo stretchy=false>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator=true>,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=false>)</mo></mrow></msub><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=false>(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mi mathvariant=normal>/</mi><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant=normal>/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>PE_{(pos,2i+1)}=cos(pos/10000^{2i/d_{model}})</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0385em;vertical-align:-.3552em></span><span class="mord mathnormal" style=margin-right:.13889em>P</span><span class=mord><span class="mord mathnormal" style=margin-right:.05764em>E</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3448em><span style=top:-2.5198em;margin-left:-.0576em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mtight mopen">(</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span><span class="mtight mpunct">,</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mtight mbin">+</span><span class="mord mtight">1</span><span class="mtight mclose">)</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.3552em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1.188em;vertical-align:-.25em></span><span class="mord mathnormal">cos</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class=mord>/1000</span><span class=mord><span class=mord>0</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.938em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight sizing reset-size6 size3"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3448em><span style=top:-2.3488em;margin-left:0;margin-right:.0714em><span class=pstrut style=height:2.5em></span><span class="mtight sizing reset-size3 size1"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style=margin-right:.01968em>l</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.1512em><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span><p>Trong đó, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><annotation encoding=application/x-tex>pos</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span> đại diện cho chỉ mục vị trí, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span> đại diện cho chỉ số chiều. Nghĩa là mỗi chiều <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.6595em></span><span class="mord mathnormal">i</span></span></span></span> của positional embedding pos tương ứng với một sóng sin.</p><p>Trong hình dưới này minh họa cho cách tính position embedding của tác giả với số chiều là 6. Giá trị của các vector tại mỗi vị trí được tính toán theo công thức ở hình dưới. <img alt="" decoding=async height=338 loading=lazy src=/_astro/pe.DBRBheeM_11rRP7.webp width=1209></p><p>Bản thân việc nhúng vị trí là một thông tin vị trí tuyệt đối, nhưng trong ngôn ngữ, vị trí tương đối cũng rất quan trọng, bởi vì</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy=false>(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo stretchy=false>)</mo><mo>=</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi><mo>+</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi><mi>cos</mi><mo>⁡</mo><mo stretchy=false>(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo stretchy=false>)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi></mrow><annotation encoding=application/x-tex>sin(\alpha+\beta)=sin\alpha cos\beta+cos\alpha sin\beta\cos(\alpha+\beta)=cos\alpha cos\beta-sin\alpha sin\beta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05278em>β</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class="mord mathnormal">cos</span><span class="mord mathnormal" style=margin-right:.05278em>β</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.05278em>β</span><span class=mspace style=margin-right:.1667em></span><span class=mop>cos</span><span class=mopen>(</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.05278em>β</span><span class=mclose>)</span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">cos</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class="mord mathnormal">cos</span><span class="mord mathnormal" style=margin-right:.05278em>β</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8889em;vertical-align:-.1944em></span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.0037em>α</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style=margin-right:.05278em>β</span></span></span></span></span><p>cho thấy vector tại vị trí <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>p</mi><mo>+</mo><mi>k</mi></mrow><annotation encoding=application/x-tex>p + k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.7778em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span><span class=mspace style=margin-right:.2222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.6944em></span><span class="mord mathnormal" style=margin-right:.03148em>k</span></span></span></span> có thể được biểu diễn dưới dạng phép biến đổi tuyến tính của vectơ tại vị trí <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>p</mi></mrow><annotation encoding=application/x-tex>p</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.625em;vertical-align:-.1944em></span><span class="mord mathnormal">p</span></span></span></span>, điều này cung cấp khả năng thể hiện thông tin vị trí tương đối. Phiên bản hình sin cũng cho phép mô hình ngoại suy với độ dài chuỗi dài hơn so với độ dài chuỗi gặp phải trong quá trình huấn luyện.</p><h2 id=q--a>Q &#x26; A</h2><h3 id=tại-sao-transformer-cần-multi-head-attention>Tại sao Transformer cần Multi-head Attention ?</h3><p>Bài báo đề cập lý do việc tiến hành Multi-head Attention là để chia mô hình thành nhiều đầu để tạo thành nhiều không gian con, cho phép mô hình chú ý đến các khía cạnh khác nhau của thông tin và cuối cùng tổng hợp thông tin từ tất cả các khía cạnh. Trên thực tế, có thể hình dung bằng trực giác rằng nếu bạn tự thiết kế một mô hình như vậy, attention sẽ không chỉ được thực hiện một lần, kết quả tổng hợp của nhiều lần chú ý ít nhất có thể nâng cao mô hình và cũng có thể được so sánh với vai trò của việc sử dụng nhiều tích chập cùng lúc trong CNN, theo trực giác, sự chú ý của nhiều người đứng đầu giúp mạng nắm bắt được các tính năng/ thông tin phong phú hơn.</p><h3 id=ưu-điểm-của-transformer-so-với-rnnlstm-là-gì-tại-sao>Ưu điểm của Transformer so với RNN/LSTM là gì? Tại sao?</h3><ol><li>Các mô hình RNN không thể tính toán song song vì việc tính toán tại thời điểm T phụ thuộc vào kết quả tính toán của lớp ẩn tại thời điểm T - 1, còn việc tính toán tại thời điểm T - 1 lại phụ thuộc tính toán của lớp ẩn tại thời điểm T - 2.</li><li>Khả năng trích xuất đặc trưng của Transformer tốt hơn so với các mô hình RNN.</li></ol><h3 id=tại-sao-transformer-có-thể-thay-thế-seq2seq>Tại sao Transformer có thể thay thế seq2seq?</h3><p>Từ thay thế ở đây hơi không phù hợp, seq2seq tuy cũ nhưng vẫn có chỗ đứng, vấn đề lớn nhất của seq2seq là ở chỗ <strong>Nén thông tin ở phía Encoder thành một vector có độ dài cố định</strong> và sử dụng nó làm đầu vào của trạng thái đầu tiên ở phía Decoder, để dự đoán trạng thái ẩn của từ đầu tiên (mã thông báo) ở phía Decoder. Khi chuỗi đầu vào tương đối dài, điều này rõ ràng sẽ mất rất nhiều thông tin ở phía Encoder và vector cố định sẽ được gửi đến phía Decoder cùng một lúc, <strong>bên Decoder không thể chú ý đến thông tin mà nó muốn chú ý</strong>. Mô hinh transformer không chỉ cải thiện đáng kể hai khuyết điểm này của mô hình seq2seq (Mô-đun attention tương tác nhiều đầu), và cũng giới thiệu mô-đun self-attention, trước tiên hãy để trình tự nguồn và trình tự đích được “tự liên kết”, trong trường hợp này, thông tin chứa trong embedding của trình tự nguồn và trình tự đích sẽ phong phú hơn và lớp FFN tiếp theo cũng nâng cao khả năng biểu đạt của mô hình, và tính toán song song của Transfomer vượt xa các model seq2seq.</p><h2 id=tham-khảo>Tham khảo</h2><p>[1] <a href=https://arxiv.org/abs/1706.03762 target=_blank rel="nofollow, noopener, noreferrer">Attention is All You Need</a></p></div></article></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc" style=--primaryColor:#64574D data-astro-cid-san3gjmf><div class="flex flex-col gap-y-2 border px-3 py-2 relative rounded-xl sm:px-4 sm:py-3"><svg class="opacity-10 absolute end-4 size-20 top-4"><use href=/icons/copyright-sponsor.svg#mingcute-copyright-line></use></svg><div class="flex flex-col"><div class=text-foreground>Attention is All You Need</div><div class=text-sm>https://zhaospei.github.io//blog/attention-is-all-you-need</div></div><div class="flex flex-row flex-wrap gap-x-5 gap-y-1 justify-start sm:gap-x-8"><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Author</span> <span class="text-sm max-sm:place-self-center">Tuan-Dung Bui</span></div><div class="flex gap-x-2 sm:flex-col sm:min-w-16"><span class=text-foreground>Update date</span> <span class="text-sm max-sm:place-self-center">October 6, 2023</span></div><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Copyright</span> <a href=https://creativecommons.org/licenses/by/4.0/ class="text-muted-foreground text-sm max-sm:place-self-center" target=_blank>CC BY-NC-SA 4.0</a></div></div><div class=relative><div class="flex flex-row gap-3"><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=copy-link><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-link-2-line></use></svg></button><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=get-qrcode><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-qrcode-2-line></use></svg></button><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=share-weibo><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-weibo-line></use></svg></button></div><div class="transition-all duration-300 ease-in-out *:my-0 -mt-2 absolute aria-expanded:max-h-[256px] aria-expanded:opacity-100 aria-expanded:translate-y-4 bg-primary-foreground border box-content max-h-0 opacity-0 overflow-hidden p-4 rounded-xl z-10" id=qrcode aria-expanded=false></div></div></div><div class="border-t-0 border mx-6 pb-1.5 pt-1 px-3 rounded-b-xl sm:mx-8 sm:px-4"><a href=/projects#sponsorship class="flex justify-between no-underline text-muted-foreground" target=_blank><div>Buy me a cup of coffee ☕.</div><svg class="size-5 m-1"><use href=/icons/copyright-sponsor.svg#mingcute-receive-money-line></use></svg></a></div><script type=module>import QRCode from"/scripts/qrcode.js";const link=window.location.href,copyLink=document.getElementById("copy-link");function loadqrcode(e){if(!e)throw new Error("qrcode container not found");""===e.innerHTML&&new QRCode(e,link)}copyLink?.addEventListener("click",(()=>{navigator.clipboard.writeText(link)}));const getQRCode=document.getElementById("get-qrcode"),qrcodeContainer=document.getElementById("qrcode");if(!qrcodeContainer)throw new Error("qrcode container not found");getQRCode?.addEventListener("click",(()=>{"true"===qrcodeContainer.ariaExpanded?qrcodeContainer.ariaExpanded="false":(loadqrcode(qrcodeContainer),qrcodeContainer.ariaExpanded="true")}));const shareWeibo=document.getElementById("share-weibo");shareWeibo?.addEventListener("click",(()=>{const e=`http://service.weibo.com/share/share.php?url=${link}&title=${document.title}&pic=https://cravatar.cn/avatar/1ffe42aa45a6b1444a786b1f32dfa8aa?s=400`;window.open(e,"_blank")}))</script><div class="mt-3 sm:mt-6 gap-2 grid grid-cols-1 sm:gap-4 sm:grid-cols-2"><a href=/blog/seq2seq-pytorch class="duration-300 transition-colors border border-transparent flex gap-3 group hover:bg-primary-foreground items-center no-underline px-4 py-2 rounded-lg sm:py-4"><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground rotate-180" height=20 viewBox="0 0 24 24" width=20 fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2.5 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg><div class="flex flex-col gap-0.5 grow sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Prev</div><div class="transition-colors font-medium whitespace-nowrap">Triển khai seq2seq với Pytorch</div></div></a><a href=/blog/what-is-bug class="duration-300 transition-colors border border-transparent flex gap-3 group hover:bg-primary-foreground items-center no-underline px-4 py-2 rounded-lg sm:py-4 text-right"><div class="flex flex-col gap-0.5 grow sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Next</div><div class="transition-colors font-medium whitespace-nowrap">Bọ là gì? Defect, Fault, Error, Bug, Failure?</div></div><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground" height=20 viewBox="0 0 24 24" width=20 fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2.5 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg></a></div><comment-component data-astro-cid-ksttp56e><div class="mt-3 sm:mt-6 not-prose" id=waline data-astro-cid-ksttp56e>Comment seems to stuck. Try to refresh?✨</div></comment-component></div><button class="transition-all duration-300 bg-primary-foreground opacity-0 border-2 border-transparent bottom-8 data-[show=true]:opacity-100 data-[show=true]:translate-y-0 end-4 fixed flex group h-10 hover:border-border/75 items-center justify-center rounded-full sm:end-8 sm:h-12 sm:w-12 text-muted-foreground translate-y-28 w-10 z-90" id=to-top-btn aria-label="Back to Top" data-show=false><div class="flex items-center justify-center absolute bottom-0 end-0 group-[.ended]:opacity-0 group-hover:opacity-0 start-0 top-0 transition-opacity"><span class=text>10</span> <span class=text-xs>%</span></div><svg class="size-6 group-[.ended]:opacity-100 group-hover:opacity-100 opacity-0 transition-opacity"><use href=/icons/ui.svg#mingcute-up-line></use></svg></button><script>!function(){const e=document.getElementById("to-top-btn"),t=e.children[0].children[0],n=document.getElementById("blog-hero"),o=document.getElementById("content");e.addEventListener("click",(()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})}));new IntersectionObserver((function(t){t.forEach((t=>{e.dataset.show=(!t.isIntersecting).toString()}))})).observe(n);{const n=o.scrollHeight,c=o.offsetTop,d=document.documentElement.clientHeight;document.addEventListener("scroll",(()=>{const o=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;if(!(e<c))return Math.round((e-c)/(n-d)*100)}();void 0!==o&&(t.innerText=o.toString(),e.classList.toggle("ended",o>100))}))}}()</script></div><footer class="w-full mx-auto mt-24"><div class="border-t border-border pt-5"><div class="flex items-center flex-col sm:flex-row gap-y-3 sm:flex sm:gap-y-0 sm:items-center sm:justify-between"><div class="flex items-center flex-col sm:flex-row gap-2 sm:gap-x-4 text-sm"><a href="https://icp.gov.moe/?keyword=APTX4869" class="text-muted-foreground text-xs py-[3px]" target=_blank>ICP - APTX4869</a><p class="">© <samp>2024</samp> Tuan-Dung Bui. All rights reserved.</p></div><div class="flex items-center justify-between"><div class="flex items-center gap-x-4"><a href=https://github.com/zhaospei class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=github><svg class=size-6><use href=/icons/social.svg#mingcute-github-line></use></svg> </a><a href=/rss.xml class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=rss><svg class=size-6><use href=/icons/social.svg#mingcute-rss-2-line></use></svg></a></div></div></div></div></footer></main></body></html>